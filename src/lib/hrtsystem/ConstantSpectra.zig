const std = @import("std");
const vk = @import("vulkan");

const engine = @import("../engine.zig");

const core = engine.core;
const VulkanContext = core.VulkanContext;
const Encoder = core.Encoder;
const VkAllocator = core.Allocator;
const Image = core.Image;
const vk_helpers = core.vk_helpers;

const F32x2 = engine.vector.Vec2(f32);
const F32x3 = engine.vector.Vec3(f32);
const F32x4 = engine.vector.Vec4(f32);

pub const DescriptorLayout = core.descriptor.DescriptorLayout(&.{
    .{
        .descriptor_type = .sampler,
        .descriptor_count = 1,
        .stage_flags = .{ .raygen_bit_khr = true, .compute_bit = true },
    },
    .{
        .descriptor_type = .sampled_image,
        .descriptor_count = 1,
        .stage_flags = .{ .raygen_bit_khr = true, .compute_bit = true },
    },
    .{
        .descriptor_type = .sampled_image,
        .descriptor_count = 1,
        .stage_flags = .{ .raygen_bit_khr = true, .compute_bit = true },
    },
    .{
        .descriptor_type = .sampled_image,
        .descriptor_count = 1,
        .stage_flags = .{ .raygen_bit_khr = true, .compute_bit = true },
    },
    .{
        .descriptor_type = .sampled_image,
        .descriptor_count = 1,
        .stage_flags = .{ .raygen_bit_khr = true, .compute_bit = true },
    },
    .{
        .descriptor_type = .sampled_image,
        .descriptor_count = 1,
        .stage_flags = .{ .raygen_bit_khr = true, .compute_bit = true },
    },
    .{
        .descriptor_type = .sampled_image,
        .descriptor_count = 1,
        .stage_flags = .{ .raygen_bit_khr = true, .compute_bit = true },
    },
    .{
        .descriptor_type = .sampled_image,
        .descriptor_count = 1,
        .stage_flags = .{ .raygen_bit_khr = true, .compute_bit = true },
    },
}, .{}, 1, "Constant Spectra");

const Self = @This();

descriptor_layout: DescriptorLayout,
descriptor_set: vk.DescriptorSet,
sampler: vk.Sampler,
cie_x: Image,
cie_y: Image,
cie_z: Image,
linear_srgb_r: Image,
linear_srgb_g: Image,
linear_srgb_b: Image,
d65: Image,

fn createSpectrumImage(vc: *const VulkanContext, vk_allocator: *VkAllocator, encoder: Encoder, descriptor_set: vk.DescriptorSet, dst_binding: u32, data: []const f32, name: [:0]const u8) !std.meta.Tuple(&.{ VkAllocator.HostBuffer(f32), Image }) {
    const extent = vk.Extent2D {
        .width = @intCast(data.len),
        .height = 1,
    };
    const image = try Image.create(vc, vk_allocator, extent, .{ .transfer_dst_bit = true, .sampled_bit = true }, .r32_sfloat, false, name);

    const staging_buffer = try vk_allocator.createHostBuffer(vc, f32, @intCast(data.len), .{ .transfer_src_bit = true });
    @memcpy(staging_buffer.data, data);
    encoder.uploadDataToImage(f32, image.handle, staging_buffer, extent, .shader_read_only_optimal);

    vc.device.updateDescriptorSets(1, @ptrCast(&.{
        vk.WriteDescriptorSet {
            .dst_set = descriptor_set,
            .dst_binding = dst_binding,
            .dst_array_element = 0,
            .descriptor_count = 1,
            .descriptor_type = .sampled_image,
            .p_image_info = @ptrCast(&vk.DescriptorImageInfo {
                .image_layout = .shader_read_only_optimal,
                .image_view = image.view,
                .sampler = .null_handle,
            }),
            .p_buffer_info = undefined,
            .p_texel_buffer_view = undefined,
        },
    }), 0, null);

    return .{ staging_buffer, image };
}

pub fn create(vc: *const VulkanContext, vk_allocator: *VkAllocator, encoder: Encoder) !Self {
    const sampler = try vc.device.createSampler(&.{
        .flags = .{},
        .mag_filter = .linear,
        .min_filter = .linear,
        .mipmap_mode = .linear,
        .address_mode_u = .clamp_to_border,
        .address_mode_v = .clamp_to_border,
        .address_mode_w = .clamp_to_border,
        .mip_lod_bias = 0.0,
        .anisotropy_enable = vk.FALSE,
        .max_anisotropy = 0.0,
        .compare_enable = vk.FALSE,
        .compare_op = .always,
        .min_lod = 0.0,
        .max_lod = 0.0,
        .border_color = .float_opaque_black,
        .unnormalized_coordinates = vk.FALSE,
    }, null);

    const descriptor_layout = try DescriptorLayout.create(vc, .{ sampler });

    var descriptor_set: vk.DescriptorSet = undefined;
    try vc.device.allocateDescriptorSets(&vk.DescriptorSetAllocateInfo {
        .descriptor_pool = descriptor_layout.pool,
        .descriptor_set_count = 1,
        .p_set_layouts = @ptrCast(&descriptor_layout.handle),
    }, @ptrCast(&descriptor_set));
    try vk_helpers.setDebugName(vc, descriptor_set, "Constant Spectra");

    try encoder.begin();
    const cie_x_staging_buffer, const cie_x = try createSpectrumImage(vc, vk_allocator, encoder, descriptor_set, 1, &[_]f32 {
        0.000129900000, 0.000145847000, 0.000163802100, 0.000184003700, 0.000206690200, 0.000232100000, 0.000260728000, 0.000293075000, 0.000329388000, 0.000369914000, 0.000414900000, 0.000464158700, 0.000518986000, 0.000581854000, 0.000655234700, 0.000741600000, 0.000845029600, 0.000964526800, 0.001094949000, 0.001231154000, 0.001368000000, 0.001502050000, 0.001642328000, 0.001802382000, 0.001995757000, 0.002236000000, 0.002535385000, 0.002892603000, 0.003300829000, 0.003753236000, 0.004243000000, 0.004762389000, 0.005330048000, 0.005978712000, 0.006741117000, 0.007650000000, 0.008751373000, 0.010028880000, 0.011421700000, 0.012869010000, 0.014310000000, 0.015704430000, 0.017147440000, 0.018781220000, 0.020748010000, 0.023190000000, 0.026207360000, 0.029782480000, 0.033880920000, 0.038468240000, 0.043510000000, 0.048995600000, 0.055022600000, 0.061718800000, 0.069212000000, 0.077630000000, 0.086958110000, 0.097176720000, 0.108406300000, 0.120767200000, 0.134380000000, 0.149358200000, 0.165395700000, 0.181983100000, 0.198611000000, 0.214770000000, 0.230186800000, 0.244879700000, 0.258777300000, 0.271807900000, 0.283900000000, 0.294943800000, 0.304896500000, 0.313787300000, 0.321645400000, 0.328500000000, 0.334351300000, 0.339210100000, 0.343121300000, 0.346129600000, 0.348280000000, 0.349599900000, 0.350147400000, 0.350013000000, 0.349287000000, 0.348060000000, 0.346373300000, 0.344262400000, 0.341808800000, 0.339094100000, 0.336200000000, 0.333197700000, 0.330041100000, 0.326635700000, 0.322886800000, 0.318700000000, 0.314025100000, 0.308884000000, 0.303290400000, 0.297257900000, 0.290800000000, 0.283970100000, 0.276721400000, 0.268917800000, 0.260422700000, 0.251100000000, 0.240847500000, 0.229851200000, 0.218407200000, 0.206811500000, 0.195360000000, 0.184213600000, 0.173327300000, 0.162688100000, 0.152283300000, 0.142100000000, 0.132178600000, 0.122569600000, 0.113275200000, 0.104297900000, 0.095640000000, 0.087299550000, 0.079308040000, 0.071717760000, 0.064580990000, 0.057950010000, 0.051862110000, 0.046281520000, 0.041150880000, 0.036412830000, 0.032010000000, 0.027917200000, 0.024144400000, 0.020687000000, 0.017540400000, 0.014700000000, 0.012161790000, 0.009919960000, 0.007967240000, 0.006296346000, 0.004900000000, 0.003777173000, 0.002945320000, 0.002424880000, 0.002236293000, 0.002400000000, 0.002925520000, 0.003836560000, 0.005174840000, 0.006982080000, 0.009300000000, 0.012149490000, 0.015535880000, 0.019477520000, 0.023992770000, 0.029100000000, 0.034814850000, 0.041120160000, 0.047985040000, 0.055378610000, 0.063270000000, 0.071635010000, 0.080462240000, 0.089739960000, 0.099456450000, 0.109600000000, 0.120167400000, 0.131114500000, 0.142367900000, 0.153854200000, 0.165500000000, 0.177257100000, 0.189140000000, 0.201169400000, 0.213365800000, 0.225749900000, 0.238320900000, 0.251066800000, 0.263992200000, 0.277101700000, 0.290400000000, 0.303891200000, 0.317572600000, 0.331438400000, 0.345482800000, 0.359700000000, 0.374083900000, 0.388639600000, 0.403378400000, 0.418311500000, 0.433449900000, 0.448795300000, 0.464336000000, 0.480064000000, 0.495971300000, 0.512050100000, 0.528295900000, 0.544691600000, 0.561209400000, 0.577821500000, 0.594500000000, 0.611220900000, 0.627975800000, 0.644760200000, 0.661569700000, 0.678400000000, 0.695239200000, 0.712058600000, 0.728828400000, 0.745518800000, 0.762100000000, 0.778543200000, 0.794825600000, 0.810926400000, 0.826824800000, 0.842500000000, 0.857932500000, 0.873081600000, 0.887894400000, 0.902318100000, 0.916300000000, 0.929799500000, 0.942798400000, 0.955277600000, 0.967217900000, 0.978600000000, 0.989385600000, 0.999548800000, 1.009089200000, 1.018006400000, 1.026300000000, 1.033982700000, 1.040986000000, 1.047188000000, 1.052466700000, 1.056700000000, 1.059794400000, 1.061799200000, 1.062806800000, 1.062909600000, 1.062200000000, 1.060735200000, 1.058443600000, 1.055224400000, 1.050976800000, 1.045600000000, 1.039036900000, 1.031360800000, 1.022666200000, 1.013047700000, 1.002600000000, 0.991367500000, 0.979331400000, 0.966491600000, 0.952847900000, 0.938400000000, 0.923194000000, 0.907244000000, 0.890502000000, 0.872920000000, 0.854449900000, 0.835084000000, 0.814946000000, 0.794186000000, 0.772954000000, 0.751400000000, 0.729583600000, 0.707588800000, 0.685602200000, 0.663810400000, 0.642400000000, 0.621514900000, 0.601113800000, 0.581105200000, 0.561397700000, 0.541900000000, 0.522599500000, 0.503546400000, 0.484743600000, 0.466193900000, 0.447900000000, 0.429861300000, 0.412098000000, 0.394644000000, 0.377533300000, 0.360800000000, 0.344456300000, 0.328516800000, 0.313019200000, 0.298001100000, 0.283500000000, 0.269544800000, 0.256118400000, 0.243189600000, 0.230727200000, 0.218700000000, 0.207097100000, 0.195923200000, 0.185170800000, 0.174832300000, 0.164900000000, 0.155366700000, 0.146230000000, 0.137490000000, 0.129146700000, 0.121200000000, 0.113639700000, 0.106465000000, 0.099690440000, 0.093330610000, 0.087400000000, 0.081900960000, 0.076804280000, 0.072077120000, 0.067686640000, 0.063600000000, 0.059806850000, 0.056282160000, 0.052971040000, 0.049818610000, 0.046770000000, 0.043784050000, 0.040875360000, 0.038072640000, 0.035404610000, 0.032900000000, 0.030564190000, 0.028380560000, 0.026344840000, 0.024452750000, 0.022700000000, 0.021084290000, 0.019599880000, 0.018237320000, 0.016987170000, 0.015840000000, 0.014790640000, 0.013831320000, 0.012948680000, 0.012129200000, 0.011359160000, 0.010629350000, 0.009938846000, 0.009288422000, 0.008678854000, 0.008110916000, 0.007582388000, 0.007088746000, 0.006627313000, 0.006195408000, 0.005790346000, 0.005409826000, 0.005052583000, 0.004717512000, 0.004403507000, 0.004109457000, 0.003833913000, 0.003575748000, 0.003334342000, 0.003109075000, 0.002899327000, 0.002704348000, 0.002523020000, 0.002354168000, 0.002196616000, 0.002049190000, 0.001910960000, 0.001781438000, 0.001660110000, 0.001546459000, 0.001439971000, 0.001340042000, 0.001246275000, 0.001158471000, 0.001076430000, 0.000999949300, 0.000928735800, 0.000862433200, 0.000800750300, 0.000743396000, 0.000690078600, 0.000640515600, 0.000594502100, 0.000551864600, 0.000512429000, 0.000476021300, 0.000442453600, 0.000411511700, 0.000382981400, 0.000356649100, 0.000332301100, 0.000309758600, 0.000288887100, 0.000269539400, 0.000251568200, 0.000234826100, 0.000219171000, 0.000204525800, 0.000190840500, 0.000178065400, 0.000166150500, 0.000155023600, 0.000144621900, 0.000134909800, 0.000125852000, 0.000117413000, 0.000109551500, 0.000102224500, 0.000095394450, 0.000089023900, 0.000083075270, 0.000077512690, 0.000072313040, 0.000067457780, 0.000062928440, 0.000058706520, 0.000054770280, 0.000051099180, 0.000047676540, 0.000044485670, 0.000041509940, 0.000038733240, 0.000036142030, 0.000033723520, 0.000031464870, 0.000029353260, 0.000027375730, 0.000025524330, 0.000023793760, 0.000022178700, 0.000020673830, 0.000019272260, 0.000017966400, 0.000016749910, 0.000015616480, 0.000014559770, 0.000013573870, 0.000012654360, 0.000011797230, 0.000010998440, 0.000010253980, 0.000009559646, 0.000008912044, 0.000008308358, 0.000007745769, 0.000007221456, 0.000006732475, 0.000006276423, 0.000005851304, 0.000005455118, 0.000005085868, 0.000004741466, 0.000004420236, 0.000004120783, 0.000003841716, 0.000003581652, 0.000003339127, 0.000003112949, 0.000002902121, 0.000002705645, 0.000002522525, 0.000002351726, 0.000002192415, 0.000002043902, 0.000001905497, 0.000001776509, 0.000001656215, 0.000001544022, 0.000001439440, 0.000001341977, 0.000001251141
    }, "cie x");
    defer cie_x_staging_buffer.destroy(vc);
    const cie_y_staging_buffer, const cie_y = try createSpectrumImage(vc, vk_allocator, encoder, descriptor_set, 2, &[_]f32 {
        0.0000039170000, 0.0000043935810, 0.0000049296040, 0.0000055321360, 0.0000062082450, 0.0000069650000, 0.0000078132190, 0.0000087673360, 0.0000098398440, 0.0000110432300, 0.0000123900000, 0.0000138864100, 0.0000155572800, 0.0000174429600, 0.0000195837500, 0.0000220200000, 0.0000248396500, 0.0000280412600, 0.0000315310400, 0.0000352152100, 0.0000390000000, 0.0000428264000, 0.0000469146000, 0.0000515896000, 0.0000571764000, 0.0000640000000, 0.0000723442100, 0.0000822122400, 0.0000935081600, 0.0001061361000, 0.0001200000000, 0.0001349840000, 0.0001514920000, 0.0001702080000, 0.0001918160000, 0.0002170000000, 0.0002469067000, 0.0002812400000, 0.0003185200000, 0.0003572667000, 0.0003960000000, 0.0004337147000, 0.0004730240000, 0.0005178760000, 0.0005722187000, 0.0006400000000, 0.0007245600000, 0.0008255000000, 0.0009411600000, 0.0010698800000, 0.0012100000000, 0.0013620910000, 0.0015307520000, 0.0017203680000, 0.0019353230000, 0.0021800000000, 0.0024548000000, 0.0027640000000, 0.0031178000000, 0.0035264000000, 0.0040000000000, 0.0045462400000, 0.0051593200000, 0.0058292800000, 0.0065461600000, 0.0073000000000, 0.0080865070000, 0.0089087200000, 0.0097676800000, 0.0106644300000, 0.0116000000000, 0.0125731700000, 0.0135827200000, 0.0146296800000, 0.0157150900000, 0.0168400000000, 0.0180073600000, 0.0192144800000, 0.0204539200000, 0.0217182400000, 0.0230000000000, 0.0242946100000, 0.0256102400000, 0.0269585700000, 0.0283512500000, 0.0298000000000, 0.0313108300000, 0.0328836800000, 0.0345211200000, 0.0362257100000, 0.0380000000000, 0.0398466700000, 0.0417680000000, 0.0437660000000, 0.0458426700000, 0.0480000000000, 0.0502436800000, 0.0525730400000, 0.0549805600000, 0.0574587200000, 0.0600000000000, 0.0626019700000, 0.0652775200000, 0.0680420800000, 0.0709110900000, 0.0739000000000, 0.0770160000000, 0.0802664000000, 0.0836668000000, 0.0872328000000, 0.0909800000000, 0.0949175500000, 0.0990458400000, 0.1033674000000, 0.1078846000000, 0.1126000000000, 0.1175320000000, 0.1226744000000, 0.1279928000000, 0.1334528000000, 0.1390200000000, 0.1446764000000, 0.1504693000000, 0.1564619000000, 0.1627177000000, 0.1693000000000, 0.1762431000000, 0.1835581000000, 0.1912735000000, 0.1994180000000, 0.2080200000000, 0.2171199000000, 0.2267345000000, 0.2368571000000, 0.2474812000000, 0.2586000000000, 0.2701849000000, 0.2822939000000, 0.2950505000000, 0.3085780000000, 0.3230000000000, 0.3384021000000, 0.3546858000000, 0.3716986000000, 0.3892875000000, 0.4073000000000, 0.4256299000000, 0.4443096000000, 0.4633944000000, 0.4829395000000, 0.5030000000000, 0.5235693000000, 0.5445120000000, 0.5656900000000, 0.5869653000000, 0.6082000000000, 0.6293456000000, 0.6503068000000, 0.6708752000000, 0.6908424000000, 0.7100000000000, 0.7281852000000, 0.7454636000000, 0.7619694000000, 0.7778368000000, 0.7932000000000, 0.8081104000000, 0.8224962000000, 0.8363068000000, 0.8494916000000, 0.8620000000000, 0.8738108000000, 0.8849624000000, 0.8954936000000, 0.9054432000000, 0.9148501000000, 0.9237348000000, 0.9320924000000, 0.9399226000000, 0.9472252000000, 0.9540000000000, 0.9602561000000, 0.9660074000000, 0.9712606000000, 0.9760225000000, 0.9803000000000, 0.9840924000000, 0.9874182000000, 0.9903128000000, 0.9928116000000, 0.9949501000000, 0.9967108000000, 0.9980983000000, 0.9991120000000, 0.9997482000000, 1.0000000000000, 0.9998567000000, 0.9993046000000, 0.9983255000000, 0.9968987000000, 0.9950000000000, 0.9926005000000, 0.9897426000000, 0.9864444000000, 0.9827241000000, 0.9786000000000, 0.9740837000000, 0.9691712000000, 0.9638568000000, 0.9581349000000, 0.9520000000000, 0.9454504000000, 0.9384992000000, 0.9311628000000, 0.9234576000000, 0.9154000000000, 0.9070064000000, 0.8982772000000, 0.8892048000000, 0.8797816000000, 0.8700000000000, 0.8598613000000, 0.8493920000000, 0.8386220000000, 0.8275813000000, 0.8163000000000, 0.8047947000000, 0.7930820000000, 0.7811920000000, 0.7691547000000, 0.7570000000000, 0.7447541000000, 0.7324224000000, 0.7200036000000, 0.7074965000000, 0.6949000000000, 0.6822192000000, 0.6694716000000, 0.6566744000000, 0.6438448000000, 0.6310000000000, 0.6181555000000, 0.6053144000000, 0.5924756000000, 0.5796379000000, 0.5668000000000, 0.5539611000000, 0.5411372000000, 0.5283528000000, 0.5156323000000, 0.5030000000000, 0.4904688000000, 0.4780304000000, 0.4656776000000, 0.4534032000000, 0.4412000000000, 0.4290800000000, 0.4170360000000, 0.4050320000000, 0.3930320000000, 0.3810000000000, 0.3689184000000, 0.3568272000000, 0.3447768000000, 0.3328176000000, 0.3210000000000, 0.3093381000000, 0.2978504000000, 0.2865936000000, 0.2756245000000, 0.2650000000000, 0.2547632000000, 0.2448896000000, 0.2353344000000, 0.2260528000000, 0.2170000000000, 0.2081616000000, 0.1995488000000, 0.1911552000000, 0.1829744000000, 0.1750000000000, 0.1672235000000, 0.1596464000000, 0.1522776000000, 0.1451259000000, 0.1382000000000, 0.1315003000000, 0.1250248000000, 0.1187792000000, 0.1127691000000, 0.1070000000000, 0.1014762000000, 0.0961886400000, 0.0911229600000, 0.0862648500000, 0.0816000000000, 0.0771206400000, 0.0728255200000, 0.0687100800000, 0.0647697600000, 0.0610000000000, 0.0573962100000, 0.0539550400000, 0.0506737600000, 0.0475496500000, 0.0445800000000, 0.0417587200000, 0.0390849600000, 0.0365638400000, 0.0342004800000, 0.0320000000000, 0.0299626100000, 0.0280766400000, 0.0263293600000, 0.0247080500000, 0.0232000000000, 0.0218007700000, 0.0205011200000, 0.0192810800000, 0.0181206900000, 0.0170000000000, 0.0159037900000, 0.0148371800000, 0.0138106800000, 0.0128347800000, 0.0119200000000, 0.0110683100000, 0.0102733900000, 0.0095333110000, 0.0088461570000, 0.0082100000000, 0.0076237810000, 0.0070854240000, 0.0065914760000, 0.0061384850000, 0.0057230000000, 0.0053430590000, 0.0049957960000, 0.0046764040000, 0.0043800750000, 0.0041020000000, 0.0038384530000, 0.0035890990000, 0.0033542190000, 0.0031340930000, 0.0029290000000, 0.0027381390000, 0.0025598760000, 0.0023932440000, 0.0022372750000, 0.0020910000000, 0.0019535870000, 0.0018245800000, 0.0017035800000, 0.0015901870000, 0.0014840000000, 0.0013844960000, 0.0012912680000, 0.0012040920000, 0.0011227440000, 0.0010470000000, 0.0009765896000, 0.0009111088000, 0.0008501332000, 0.0007932384000, 0.0007400000000, 0.0006900827000, 0.0006433100000, 0.0005994960000, 0.0005584547000, 0.0005200000000, 0.0004839136000, 0.0004500528000, 0.0004183452000, 0.0003887184000, 0.0003611000000, 0.0003353835000, 0.0003114404000, 0.0002891656000, 0.0002684539000, 0.0002492000000, 0.0002313019000, 0.0002146856000, 0.0001992884000, 0.0001850475000, 0.0001719000000, 0.0001597781000, 0.0001486044000, 0.0001383016000, 0.0001287925000, 0.0001200000000, 0.0001118595000, 0.0001043224000, 0.0000973356000, 0.0000908458700, 0.0000848000000, 0.0000791466700, 0.0000738580000, 0.0000689160000, 0.0000643026700, 0.0000600000000, 0.0000559818700, 0.0000522256000, 0.0000487184000, 0.0000454474700, 0.0000424000000, 0.0000395610400, 0.0000369151200, 0.0000344486800, 0.0000321481600, 0.0000300000000, 0.0000279912500, 0.0000261135600, 0.0000243602400, 0.0000227246100, 0.0000212000000, 0.0000197785500, 0.0000184528500, 0.0000172168700, 0.0000160645900, 0.0000149900000, 0.0000139872800, 0.0000130515500, 0.0000121781800, 0.0000113625400, 0.0000106000000, 0.0000098858770, 0.0000092173040, 0.0000085923620, 0.0000080091330, 0.0000074657000, 0.0000069595670, 0.0000064879950, 0.0000060486990, 0.0000056393960, 0.0000052578000, 0.0000049017710, 0.0000045697200, 0.0000042601940, 0.0000039717390, 0.0000037029000, 0.0000034521630, 0.0000032183020, 0.0000030003000, 0.0000027971390, 0.0000026078000, 0.0000024312200, 0.0000022665310, 0.0000021130130, 0.0000019699430, 0.0000018366000, 0.0000017122300, 0.0000015962280, 0.0000014880900, 0.0000013873140, 0.0000012934000, 0.0000012058200, 0.0000011241430, 0.0000010480090, 0.0000009770578, 0.0000009109300, 0.0000008492513, 0.0000007917212, 0.0000007380904, 0.0000006881098, 0.0000006415300, 0.0000005980895, 0.0000005575746, 0.0000005198080, 0.0000004846123, 0.0000004518100
    }, "cie y");
    defer cie_y_staging_buffer.destroy(vc);
    const cie_z_staging_buffer, const cie_z = try createSpectrumImage(vc, vk_allocator, encoder, descriptor_set, 3, &[_]f32 {
        0.000606100000, 0.000680879200, 0.000765145600, 0.000860012400, 0.000966592800, 0.001086000000, 0.001220586000, 0.001372729000, 0.001543579000, 0.001734286000, 0.001946000000, 0.002177777000, 0.002435809000, 0.002731953000, 0.003078064000, 0.003486000000, 0.003975227000, 0.004540880000, 0.005158320000, 0.005802907000, 0.006450001000, 0.007083216000, 0.007745488000, 0.008501152000, 0.009414544000, 0.010549990000, 0.011965800000, 0.013655870000, 0.015588050000, 0.017730150000, 0.020050010000, 0.022511360000, 0.025202880000, 0.028279720000, 0.031897040000, 0.036210000000, 0.041437710000, 0.047503720000, 0.054119880000, 0.060998030000, 0.067850010000, 0.074486320000, 0.081361560000, 0.089153640000, 0.098540480000, 0.110200000000, 0.124613300000, 0.141701700000, 0.161303500000, 0.183256800000, 0.207400000000, 0.233692100000, 0.262611400000, 0.294774600000, 0.330798500000, 0.371300000000, 0.416209100000, 0.465464200000, 0.519694800000, 0.579530300000, 0.645600000000, 0.718483800000, 0.796713300000, 0.877845900000, 0.959439000000, 1.039050100000, 1.115367300000, 1.188497100000, 1.258123300000, 1.323929600000, 1.385600000000, 1.442635200000, 1.494803500000, 1.542190300000, 1.584880700000, 1.622960000000, 1.656404800000, 1.685295900000, 1.709874500000, 1.730382100000, 1.747060000000, 1.760044600000, 1.769623300000, 1.776263700000, 1.780433400000, 1.782600000000, 1.782968200000, 1.781699800000, 1.779198200000, 1.775867100000, 1.772110000000, 1.768258900000, 1.764039000000, 1.758943800000, 1.752466300000, 1.744100000000, 1.733559500000, 1.720858100000, 1.705936900000, 1.688737200000, 1.669200000000, 1.647528700000, 1.623412700000, 1.596022300000, 1.564528000000, 1.528100000000, 1.486111400000, 1.439521500000, 1.389879900000, 1.338736200000, 1.287640000000, 1.237422300000, 1.187824300000, 1.138761100000, 1.090148000000, 1.041900000000, 0.994197600000, 0.947347300000, 0.901453100000, 0.856619300000, 0.812950100000, 0.770517300000, 0.729444800000, 0.689913600000, 0.652104900000, 0.616200000000, 0.582328600000, 0.550416200000, 0.520337600000, 0.491967300000, 0.465180000000, 0.439924600000, 0.416183600000, 0.393882200000, 0.372945900000, 0.353300000000, 0.334857800000, 0.317552100000, 0.301337500000, 0.286168600000, 0.272000000000, 0.258817100000, 0.246483800000, 0.234771800000, 0.223453300000, 0.212300000000, 0.201169200000, 0.190119600000, 0.179225400000, 0.168560800000, 0.158200000000, 0.148138300000, 0.138375800000, 0.128994200000, 0.120075100000, 0.111700000000, 0.103904800000, 0.096667480000, 0.089982720000, 0.083845310000, 0.078249990000, 0.073208990000, 0.068678160000, 0.064567840000, 0.060788350000, 0.057250010000, 0.053904350000, 0.050746640000, 0.047752760000, 0.044898590000, 0.042160000000, 0.039507280000, 0.036935640000, 0.034458360000, 0.032088720000, 0.029840000000, 0.027711810000, 0.025694440000, 0.023787160000, 0.021989250000, 0.020300000000, 0.018718050000, 0.017240360000, 0.015863640000, 0.014584610000, 0.013400000000, 0.012307230000, 0.011301880000, 0.010377920000, 0.009529306000, 0.008749999000, 0.008035200000, 0.007381600000, 0.006785400000, 0.006242800000, 0.005749999000, 0.005303600000, 0.004899800000, 0.004534200000, 0.004202400000, 0.003900000000, 0.003623200000, 0.003370600000, 0.003141400000, 0.002934800000, 0.002749999000, 0.002585200000, 0.002438600000, 0.002309400000, 0.002196800000, 0.002100000000, 0.002017733000, 0.001948200000, 0.001889800000, 0.001840933000, 0.001800000000, 0.001766267000, 0.001737800000, 0.001711200000, 0.001683067000, 0.001650001000, 0.001610133000, 0.001564400000, 0.001513600000, 0.001458533000, 0.001400000000, 0.001336667000, 0.001270000000, 0.001205000000, 0.001146667000, 0.001100000000, 0.001068800000, 0.001049400000, 0.001035600000, 0.001021200000, 0.001000000000, 0.000968640000, 0.000929920000, 0.000886880000, 0.000842560000, 0.000800000000, 0.000760960000, 0.000723680000, 0.000685920000, 0.000645440000, 0.000600000000, 0.000547866700, 0.000491600000, 0.000435400000, 0.000383466700, 0.000340000000, 0.000307253300, 0.000283160000, 0.000265440000, 0.000251813300, 0.000240000000, 0.000229546700, 0.000220640000, 0.000211960000, 0.000202186700, 0.000190000000, 0.000174213300, 0.000155640000, 0.000135960000, 0.000116853300, 0.000100000000, 0.000086133330, 0.000074600000, 0.000065000000, 0.000056933330, 0.000049999990, 0.000044160000, 0.000039480000, 0.000035720000, 0.000032640000, 0.000030000000, 0.000027653330, 0.000025560000, 0.000023640000, 0.000021813330, 0.000020000000, 0.000018133330, 0.000016200000, 0.000014200000, 0.000012133330, 0.000010000000, 0.000007733333, 0.000005400000, 0.000003200000, 0.000001333333, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000
    }, "cie z");
    defer cie_z_staging_buffer.destroy(vc);
    const linear_srgb_r_staging_buffer, const linear_srgb_r = try createSpectrumImage(vc, vk_allocator, encoder, descriptor_set, 4, &[_]f32 {
        0.332825725462912, 0.332756689713231, 0.332677312160907, 0.332586942122363, 0.332483678961862, 0.332367400757396, 0.332234987485216, 0.332083790900008, 0.331912211784181, 0.331719247941272, 0.331501275994025, 0.331290295224807, 0.331057032853893, 0.3307893626485, 0.330476651646831, 0.330109787396836, 0.329670816907604, 0.329165256644095, 0.328616756333376, 0.328048543171703, 0.327483447643804, 0.326849801901831, 0.326177671590705, 0.325408250599315, 0.324478385056095, 0.323323678760673, 0.321883707241075, 0.320158336878631, 0.318172651894009, 0.315953236775689, 0.313527775515611, 0.309990139561067, 0.30597712761602, 0.301296465479578, 0.295737642810268, 0.289080459993601, 0.281028671279803, 0.271660852385632, 0.261367123214138, 0.250582299327616, 0.23975433245798, 0.231155483133827, 0.222515384490434, 0.213172620406399, 0.202618777377107, 0.190552111525886, 0.177085514712547, 0.162939105571157, 0.148817890522734, 0.135257220555183, 0.122605583426631, 0.111637265115039, 0.101500786300664, 0.0920854897064369, 0.083335812735951, 0.0752274930925146, 0.0678498011739756, 0.061211270505929, 0.0552111523479609, 0.0497781554827522, 0.0448590395139801, 0.0407707035579746, 0.0371511657100069, 0.0340359003453307, 0.031406590499646, 0.0292224749163874, 0.0274114924989898, 0.0258873724673421, 0.0245957879741725, 0.023496036357134, 0.0225569927032584, 0.0211624389159594, 0.0199463302204532, 0.018879229349547, 0.0179379570399857, 0.0171039795316862, 0.0163627482954124, 0.0157012597506456, 0.0151079569324385, 0.0145730030507366, 0.0140887545420986, 0.0137254227937331, 0.0133939659525875, 0.0130883110691747, 0.0128084742196875, 0.0125326798980256, 0.0122753707034339, 0.0120295316442933, 0.0117920982922636, 0.0117300592374458, 0.0114771597715421, 0.0112989462139326, 0.0111767615695906, 0.01105041671425, 0.0110626815865954, 0.0108058672286797, 0.0106859979211108, 0.010569075490102, 0.0104708330027767, 0.010396627967956, 0.0103328685189361, 0.0103110038992335, 0.0102996745607282, 0.0103026901295646, 0.0103238986489357, 0.0103674252312863, 0.0104366041846648, 0.0105276198384292, 0.010633437060856, 0.0107466895466483, 0.0108594982745232, 0.0109295801776773, 0.0109951101488523, 0.0110561908768167, 0.0111132493601423, 0.0111664403748491, 0.0112141936315257, 0.0112546049139398, 0.0112873766631105, 0.0113125596075404, 0.011329714406999, 0.0114185564541771, 0.0114978833979975, 0.0115652199259752, 0.0116175429412848, 0.01165221350414, 0.0116677933114089, 0.0116637853641382, 0.011639194528726, 0.0115931260487419, 0.0115249942919169, 0.0113550508288719, 0.0111655957170165, 0.0109599199916919, 0.0107409910607919, 0.0105117078700642, 0.0102753659425208, 0.0100326539266461, 0.00978220876312509, 0.00952315440144036, 0.00925532688487021, 0.00899648197891854, 0.00873447246029151, 0.00847583093307464, 0.00822553021538854, 0.00798760215752627, 0.00776371130937933, 0.00755222270502556, 0.00735163801166012, 0.00716047938728885, 0.00697766377199401, 0.00681217348712111, 0.0066555388020807, 0.00650856579519618, 0.00637169040469183, 0.00624538888427994, 0.00612921790436376, 0.00602309665643151, 0.00592785704154163, 0.00584406613583634, 0.00577241001322008, 0.00568122314381459, 0.00560182660273811, 0.00553250339505407, 0.00547174552753433, 0.00541825841165697, 0.00537130462118597, 0.00533090636561682, 0.00529676539780297, 0.00526863232216115, 0.00524635433772095, 0.00525948896174597, 0.00527814323193158, 0.00530205320963938, 0.00533122898526314, 0.00536550838763542, 0.00540492342674813, 0.00544966749945512, 0.0054998690892927, 0.00555589647239963, 0.00561794925109677, 0.00567055013907664, 0.00572929544691074, 0.00579442596005212, 0.00586622053047148, 0.00594499967630259, 0.00603113776981286, 0.00612515720114488, 0.0062349056445384, 0.00635759807618625, 0.00651974858927689, 0.00665143258433201, 0.00682619459033066, 0.00701491412658344, 0.00717212093366048, 0.00742460288081587, 0.00758526414603593, 0.00782373352549198, 0.0080898454712307, 0.00837987888359639, 0.00869698515642584, 0.00904129652732476, 0.00941906438519514, 0.00983439631657271, 0.0102921194464087, 0.0107978633463498, 0.0113582876110073, 0.0119813333131153, 0.0126680594245983, 0.0134552337608405, 0.014331408426186, 0.0152730828886226, 0.0163425208981961, 0.0175626690650177, 0.0189629461515103, 0.020580467411522, 0.0224630358150058, 0.0246732125764258, 0.0272962689355506, 0.0304414843208496, 0.0342756710709288, 0.0392871166551197, 0.0456551175431318, 0.0539769188170307, 0.0652601639989921, 0.0813373438809253, 0.105891594786585, 0.147472496668373, 0.229916043386908, 0.420845724345074, 0.674291300178991, 0.798556423099019, 0.855294649274172, 0.886392189613406, 0.905722730724496, 0.918844059943613, 0.928217428228042, 0.935241763803349, 0.940700650416585, 0.945065592814989, 0.948637581564779, 0.951522796177074, 0.953937159269079, 0.955962183736364, 0.957658906372968, 0.959073303473011, 0.960245143370539, 0.961216058702484, 0.962019076631173, 0.962688441683404, 0.963219639523865, 0.963466218150072, 0.963457383360481, 0.963127181013454, 0.962924710095443, 0.963228838198259, 0.963466177052109, 0.963466203777071, 0.962685324106076, 0.963361494749669, 0.962958696662033, 0.962361648504974, 0.961672267998595, 0.960891882732071, 0.960021550349348, 0.959062247477714, 0.958009997630136, 0.956862479969261, 0.955624478405705, 0.95430239404009, 0.952904794596435, 0.951709387031535, 0.950455656615665, 0.949133423928481, 0.947730512327871, 0.946232856623009, 0.944631812846614, 0.942924233871977, 0.94110184730804, 0.939155225463968, 0.937074198090049, 0.934544585918001, 0.931835064359815, 0.928933905386924, 0.925828797585772, 0.922507729636267, 0.918953809901282, 0.915151337203063, 0.911091333260776, 0.906767035600478, 0.902175846380692, 0.897768439992414, 0.893114189188616, 0.888190117912271, 0.882972279658638, 0.877429743529534, 0.871539674767372, 0.865287332724865, 0.858646123539592, 0.851594688603738, 0.844107478416876, 0.836482049283654, 0.828399942424988, 0.819848744809141, 0.810824087793208, 0.801324262557745, 0.791346174858018, 0.780897265322768, 0.770023915488023, 0.758795570957421, 0.747307898362579, 0.734256782101517, 0.7210332010027, 0.70768257972723, 0.694245936114139, 0.680755879797169, 0.667308328617376, 0.65394900857912, 0.640594759771149, 0.627126511878031, 0.613379672334018, 0.598046857799485, 0.582424679996274, 0.566719785684172, 0.551170990454126, 0.536042368159482, 0.521485205955286, 0.507525421730944, 0.49424338656489, 0.48170073161392, 0.469946061844556, 0.460878293982259, 0.45242580586352, 0.444570880263788, 0.43728917227721, 0.430549090673707, 0.424340539096025, 0.418632642597421, 0.413354884404955, 0.408432283440729, 0.403782434655173, 0.399438557195987, 0.395308513483031, 0.391401683719607, 0.387727687766787, 0.384293896276488, 0.38109008012616, 0.378089878747387, 0.37527839304582, 0.372640337207098, 0.370160083796468, 0.367094636294, 0.364266362483801, 0.361659245242381, 0.359258269123211, 0.357048948771498, 0.355015444857647, 0.353144985014113, 0.351425925238953, 0.349850915279743, 0.348408444639068, 0.347575149617012, 0.346788773060868, 0.346046299522091, 0.345342532703424, 0.344673828828776, 0.344036956103401, 0.343430972167157, 0.342854074089496, 0.342306105576303, 0.341784990723577, 0.34125367896434, 0.340751535997265, 0.340276832458799, 0.339829094895988, 0.339409043060486, 0.339014945473004, 0.338645234912019, 0.338298698292504, 0.337974093153766, 0.337670102477254, 0.337295631695647, 0.336952624798536, 0.336639606640752, 0.336353256487372, 0.336092233621727, 0.33585456508017, 0.335637588223004, 0.335440561828184, 0.3352609956114, 0.335097106348718, 0.334932651000784, 0.3347837064207, 0.334647052903992, 0.334523678196393, 0.334409953578979, 0.334306469525299, 0.334211828745478, 0.334125385628138, 0.334046516264418, 0.33397463134957, 0.33395784993003, 0.333940952114694, 0.333922295799267, 0.333903928178395, 0.33388602436592, 0.333866815607726, 0.333848895235956, 0.33383044747282, 0.333811511091128, 0.333794035809472, 0.333760604905585, 0.333728818081055, 0.333699850971504, 0.333672920430473, 0.333647895376853, 0.333624631441332, 0.333602991917988, 0.333582862656285, 0.333564132073773, 0.333547377345218, 0.333531879205095, 0.333518665143231, 0.333504927505615, 0.3334933331758, 0.333481767232706, 0.33347017322137, 0.33345985378631, 0.333450106563791, 0.333440902951802, 0.33343221491365, 0.333422962542931, 0.333414253183059, 0.333406035926292, 0.333398259995748, 0.333390873934578, 0.333383829408319, 0.333377699633664, 0.333370606445542, 0.333364352935387, 0.333358287102538, 0.333352032562516, 0.333346516144793, 0.333339829385664, 0.333333801120976, 0.333327765851026, 0.333322326548908, 0.333315492969928, 0.333309832253254, 0.333303331641939, 0.333295925787339, 0.333291009823428, 0.333285931628298, 0.333281353564657, 0.333275225514341, 0.333269560263381, 0.333264328381939, 0.333257485024109, 0.333251032339059, 0.333244273263941, 0.333237182255103, 0.333229812648553, 0.333220681221551, 0.333211726629641, 0.333202256959167, 0.333192231578968, 0.333181600505456, 0.333170315837444, 0.333158334728082, 0.333145609327219, 0.333132084996488
    }, "linear srgb r");
    defer linear_srgb_r_staging_buffer.destroy(vc);
    const linear_srgb_g_staging_buffer, const linear_srgb_g = try createSpectrumImage(vc, vk_allocator, encoder, descriptor_set, 5, &[_]f32 {
        0.333219980873799, 0.333204023370739, 0.333186534141193, 0.333166633131569, 0.333144628551589, 0.333118389247418, 0.333089777961916, 0.33305636427421, 0.333018404070217, 0.332974874889904, 0.3329266763959, 0.332879917983594, 0.33282796649888, 0.33276829772426, 0.332698369749871, 0.332615613279299, 0.332515855790691, 0.332400087153073, 0.332274117867772, 0.332141932566564, 0.332008875864419, 0.331859043616271, 0.331699174726317, 0.331514719063348, 0.331288212276531, 0.331001840581139, 0.330638991078952, 0.330193210104924, 0.329668459144478, 0.32906666742183, 0.328390866030564, 0.327368475557462, 0.326156794348934, 0.324667736264608, 0.322792057713691, 0.320387568400485, 0.317246411358964, 0.313268066226774, 0.308486221777306, 0.303002751934009, 0.296995183992704, 0.291860941976048, 0.286367842608911, 0.280040199589821, 0.272385613427444, 0.262944531804774, 0.251507905141718, 0.238427706243748, 0.224229436336351, 0.209478730449617, 0.194700128163614, 0.181091142058984, 0.167856266609086, 0.154993227304999, 0.14254533870738, 0.130583593864894, 0.119343157918592, 0.108953788597349, 0.09935483653038, 0.0905006210892725, 0.0823536355158462, 0.0755016811294976, 0.0693626625620984, 0.0640295771066658, 0.0595008140370671, 0.055730512922099, 0.0526086231328191, 0.0499916236557659, 0.0477904681233311, 0.0459381622119885, 0.044383426308086, 0.0419511659851127, 0.0398423387545857, 0.0380049686582118, 0.0363981871555242, 0.0349893999554815, 0.0337545197770617, 0.03267158736793, 0.0317195883484881, 0.0308805584043991, 0.0301405954679156, 0.0296501690394382, 0.0292279091309034, 0.0288639381835507, 0.0285781376956689, 0.0282734169746762, 0.0280339620426077, 0.0278273710572105, 0.0276465337089955, 0.0284535072412556, 0.0281919843178933, 0.0279717220025401, 0.0281069486487817, 0.0282203372100355, 0.0292550866823541, 0.0284649694851705, 0.0285847705452599, 0.0287016434286884, 0.0289331433473229, 0.029319881531717, 0.0297638242037945, 0.0303581949455658, 0.0310265211454162, 0.0317955190924032, 0.0326972418849691, 0.0337715972721192, 0.0350623890892629, 0.0365846539385324, 0.0383378179749823, 0.040317875366024, 0.0425122173583572, 0.0447760446933128, 0.0472846253103529, 0.0500832334766893, 0.0532298090568643, 0.05679715184301, 0.0608638866168606, 0.0655114331307451, 0.0708483616945986, 0.0770127687236661, 0.0842026560205326, 0.0931402087775251, 0.10377555218459, 0.116560571630227, 0.132164149260179, 0.151545567526555, 0.176088816492635, 0.207896535831724, 0.250148107200483, 0.307225686756332, 0.383313787432565, 0.476269248963345, 0.572509431039411, 0.654211292578507, 0.716041094442698, 0.761521890792577, 0.795388933369216, 0.821317722952905, 0.841787634523359, 0.858394617873679, 0.872185947055424, 0.883650471646892, 0.893442382723396, 0.901882556575513, 0.909218354824018, 0.915642489688252, 0.921302345579364, 0.926326742726999, 0.930820302540335, 0.934867238934324, 0.938533236451472, 0.941793519746821, 0.944755868915987, 0.947441342469231, 0.949872516223697, 0.952069750077979, 0.954060676947444, 0.955866407918239, 0.957496945526816, 0.9589633653107, 0.960275027196984, 0.961652188448785, 0.962895854147646, 0.964029836828443, 0.965073626585897, 0.966043034293599, 0.966948378246164, 0.967791786524344, 0.968576282404343, 0.969304694228055, 0.969979952031806, 0.970439982675051, 0.97086106105718, 0.971247395181115, 0.971601952039553, 0.971928342292271, 0.972228496563228, 0.972503429642464, 0.972754935291659, 0.972983621348563, 0.973190960349819, 0.973450588169184, 0.97368986207917, 0.973909613633142, 0.974110558445704, 0.974293307063538, 0.974458415633566, 0.97460614016017, 0.974661265254388, 0.974668283836301, 0.974374600017618, 0.974658155367444, 0.97452087322849, 0.97443135073385, 0.974668313577135, 0.974309804627021, 0.974668291734378, 0.974600568571758, 0.974470254881345, 0.974314743024947, 0.97413071643819, 0.973924869659345, 0.973685584742862, 0.97340969649657, 0.973093292206466, 0.972731724937573, 0.972319171113987, 0.971848213932955, 0.97133181890202, 0.970693221809102, 0.969984912610721, 0.969266674975446, 0.968426459895197, 0.967441970517955, 0.966284075348595, 0.964915757997975, 0.963289107316537, 0.961340862301377, 0.958984133631431, 0.95610968667735, 0.952547850973673, 0.947721798788169, 0.94154060477023, 0.933405519760833, 0.922307275259997, 0.906411801834174, 0.882034191663836, 0.840623509268401, 0.758342862966285, 0.567568555097169, 0.31427191867828, 0.190253337484552, 0.133747851006037, 0.102867430827152, 0.0837362419605986, 0.0707979061999307, 0.0615881576390427, 0.0547103021741839, 0.0493826945288138, 0.0451355679842656, 0.0416695712357546, 0.0388613438498057, 0.0365128445394391, 0.0345415022941217, 0.0328852076724391, 0.0314968500741241, 0.0303360490266427, 0.0293619708968588, 0.0285424941394546, 0.0278450377935992, 0.0272723425012368, 0.0269434954164027, 0.0268378958570966, 0.0270128738043376, 0.0270680521449979, 0.02667548813686, 0.0263368367716814, 0.0262068062891309, 0.0267418984556618, 0.0260156836735436, 0.0262098315533727, 0.0265438849327694, 0.0269450255990895, 0.0274115136519727, 0.0279419147460649, 0.0285349550948406, 0.0291929348291132, 0.0299168615168904, 0.0307027253033789, 0.0315454734165103, 0.0324386339868808, 0.0331924970329042, 0.0339854322996288, 0.0348243065848193, 0.0357172574343335, 0.0366736030403013, 0.0376988439726288, 0.038794753964345, 0.0399666010635245, 0.041220381802543, 0.0425625346680379, 0.0442022949364343, 0.045959018047339, 0.0478401001909462, 0.0498532845330827, 0.0520060819021716, 0.0543092107091437, 0.0567721651101536, 0.0593996962704751, 0.0621948683722244, 0.0651577331882528, 0.067992667094615, 0.0709814581870508, 0.0741376314538859, 0.0774753311238271, 0.0810131376848129, 0.0847636409546826, 0.0887338532836635, 0.0929387483201278, 0.0973888667208841, 0.102097425439378, 0.1068734721732, 0.11191481459134, 0.117223859323304, 0.122797732045111, 0.128630403608536, 0.134716335240433, 0.14104273530674, 0.147573674475689, 0.154260615085804, 0.161039394150938, 0.16866414015253, 0.176298266816567, 0.183908376711251, 0.191463940107451, 0.198939320645892, 0.206275843629005, 0.213445124976773, 0.220488682782895, 0.227462555442875, 0.234441982678226, 0.242055229387579, 0.249613835700184, 0.25700153012769, 0.264097233684052, 0.27078315987687, 0.277004617362105, 0.282767208043725, 0.288055478329619, 0.292868325307797, 0.297211663088315, 0.300445744531881, 0.303368625974033, 0.306002035653807, 0.30837075141533, 0.310498958641424, 0.312404359463837, 0.314107935273408, 0.315642144404548, 0.317035784931041, 0.318321351262256, 0.319491234288737, 0.3205768500303, 0.321578885743382, 0.32249897019755, 0.323338740630587, 0.324104634350434, 0.324806209472606, 0.325449746234241, 0.32604120099747, 0.326586217671033, 0.327244660865829, 0.327837441136237, 0.328371677505325, 0.328852089050435, 0.32928410798095, 0.329674249719187, 0.330026358120456, 0.330344432921768, 0.330629950034957, 0.330888158534212, 0.331035195375267, 0.331172706514188, 0.331300919058579, 0.331421919741498, 0.331535982144437, 0.331643790423824, 0.331745619422463, 0.331841754556417, 0.331932570697588, 0.332018375724861, 0.332105953025864, 0.332187036591314, 0.332263728209409, 0.332336188909564, 0.33240262370525, 0.332465910431597, 0.332523704555609, 0.332578242856715, 0.332629104118244, 0.332676536971126, 0.332735353821011, 0.332788368315529, 0.332835991576453, 0.332879869527913, 0.332919711239279, 0.332955857286785, 0.332989263675165, 0.333019028936051, 0.333046075166019, 0.333070091833252, 0.333095319675104, 0.333117059414411, 0.333137907322716, 0.333155723005875, 0.333173054701584, 0.333188321492494, 0.333201639669839, 0.333214893661341, 0.333226391954416, 0.33323620207894, 0.33323924272543, 0.33324115000286, 0.333243743753041, 0.3332470062822, 0.333249035080236, 0.333252320487891, 0.333254332137774, 0.333256952493525, 0.333259541638535, 0.333262097514954, 0.333266784197677, 0.333271108161728, 0.333275755690586, 0.333279418361201, 0.333282097306794, 0.333285161127825, 0.333287956511326, 0.333291185014823, 0.333293489301265, 0.333294879497828, 0.333297268586833, 0.333298115903981, 0.333299489178471, 0.33330070921548, 0.333301781657366, 0.333302712136791, 0.333304168493811, 0.3333041571559, 0.333305326717904, 0.333305055267345, 0.333305965588646, 0.333306061024561, 0.333305360962656, 0.333305125614244, 0.333304719756552, 0.333304755494029, 0.333303382257969, 0.333303054966555, 0.333301312740344, 0.333300603570005, 0.333298363993128, 0.333296496491813, 0.333294371784899, 0.333292609027776, 0.33328992753949, 0.333286284539939, 0.333282946196897, 0.333279246476932, 0.333275157786926, 0.333271321160982, 0.333267196533912, 0.333263501801392, 0.333259551820493, 0.333255332612094, 0.333250828739424, 0.333246018850733, 0.333241554540056, 0.33323540516968, 0.333229564684152, 0.333223338991408, 0.333216187158373, 0.333208532390597, 0.33320034591933, 0.333191595291436, 0.333182889741804, 0.333172889192356, 0.333161549731062, 0.333150770985621, 0.33313856729071, 0.333125532603319,
    }, "linear srgb g");
    defer linear_srgb_g_staging_buffer.destroy(vc);
    const linear_srgb_b_staging_buffer, const linear_srgb_b = try createSpectrumImage(vc, vk_allocator, encoder, descriptor_set, 6, &[_]f32 {
        0.333953384754685, 0.334038487501301, 0.334135450743036, 0.334245806494231, 0.334371148512957, 0.33451373118473, 0.334674813181882, 0.334859473972932, 0.335069057946902, 0.335305589704058, 0.335571794063969, 0.335829559129755, 0.336114796325237, 0.336442156828388, 0.336824815771737, 0.337274455017053, 0.337813200468457, 0.33843454464739, 0.33910902731329, 0.339809436355641, 0.34050759705562, 0.341291082953637, 0.342123088561044, 0.343076971881314, 0.344233350303283, 0.345674434109636, 0.347477260962108, 0.349648417904066, 0.352158858539951, 0.354980069143269, 0.358081334989976, 0.362641365292211, 0.367866061163544, 0.374035784086492, 0.381470287286816, 0.390531961562776, 0.401724909080346, 0.415071074682456, 0.430146648077692, 0.446414943751926, 0.463250479143302, 0.47698357103216, 0.491116768551762, 0.506787177664032, 0.524995605610032, 0.546503353831777, 0.57140657872201, 0.598633186910714, 0.626952671628631, 0.655264048436759, 0.682694288382893, 0.707271589610218, 0.730642943621771, 0.75292128243929, 0.774118848955901, 0.794188912807733, 0.812807039687328, 0.829834940927412, 0.8454340106063, 0.859721222751652, 0.872787324360994, 0.883727615342376, 0.893486172439852, 0.901934521967958, 0.909092593736563, 0.915047012419447, 0.919979883701699, 0.924121004509288, 0.927613743919741, 0.930565802093644, 0.933059581092968, 0.936886394716745, 0.940211330729453, 0.943115802024328, 0.945663856131556, 0.947906620572981, 0.949882732417369, 0.951627153521727, 0.953172455105523, 0.954546439044169, 0.955770650224426, 0.956624408724544, 0.957378125166086, 0.958047750999643, 0.958613388647056, 0.959193902918129, 0.959690667048078, 0.960143098021028, 0.960561368788353, 0.959816433522636, 0.960330856391861, 0.960729331964415, 0.960716290041473, 0.96072924608281, 0.959682231757932, 0.960729163428929, 0.960729231398724, 0.960729281504639, 0.960596023542013, 0.960283490584862, 0.959903307751233, 0.959330801331468, 0.95867380396446, 0.95790179173603, 0.956978859155818, 0.955860977779607, 0.954501007298165, 0.952887726114831, 0.951028744452858, 0.948935436229554, 0.946628284816259, 0.944294375091967, 0.941720264882391, 0.938860576317192, 0.935656940646706, 0.93203640730814, 0.927921918474152, 0.923233963059997, 0.917864261984668, 0.911674671520384, 0.904467628519971, 0.895441235663272, 0.884726564151018, 0.871874206910637, 0.85621830691744, 0.836802219116021, 0.812243391584798, 0.780439677997123, 0.738212701065205, 0.681181189295223, 0.605161220431925, 0.512375698424258, 0.416324975867017, 0.334828786956356, 0.273217913985227, 0.227966401005889, 0.194335704340625, 0.1686496268943, 0.148430156891703, 0.132082227238147, 0.118558723468057, 0.107353046716135, 0.0978231436943925, 0.0896416125499734, 0.0825561140193729, 0.0763699080482639, 0.0709339425912295, 0.0661210326613715, 0.0618280577685387, 0.0579722812917521, 0.0544890986451578, 0.0513943062106831, 0.0485885900830813, 0.0460500897643533, 0.0437557921017993, 0.0416848597999172, 0.0398101051384092, 0.0381104942397406, 0.0365751945050401, 0.0351925677841127, 0.0339525614768674, 0.0326665877650491, 0.0315023188787111, 0.0304376587720577, 0.0294546271245768, 0.028538706780179, 0.0276803160962633, 0.0268773065478798, 0.0261269515850209, 0.02542667243761, 0.0247736928191011, 0.0243005271487901, 0.0238607946118705, 0.0234505501741135, 0.0230668177530275, 0.0227061478564543, 0.0223665794832239, 0.0220469014993118, 0.0217451949648101, 0.0214604812898247, 0.0211910897129908, 0.0208788610680855, 0.020580841104572, 0.0202959596878458, 0.020023219806163, 0.0197616926646484, 0.0195104461155405, 0.0192687021925807, 0.0191038285076413, 0.0189741174266465, 0.0191056508997782, 0.0186904117012553, 0.0186529315771282, 0.0185537347603986, 0.0181595647008515, 0.0182655917506689, 0.0177464439651445, 0.0175756977146268, 0.0174398992704674, 0.0173053774566241, 0.0171722978448702, 0.0170338329572659, 0.0168953505470215, 0.0167559064908819, 0.0166145872638328, 0.0164704117297829, 0.0163225409047531, 0.016170452987065, 0.0160001216746318, 0.015851544325302, 0.0156836790736673, 0.0154602414230009, 0.0152310196062334, 0.0149953605639926, 0.0147529783615928, 0.0145037746742969, 0.0142478571154145, 0.0139859258486904, 0.0137195979103229, 0.0134488302131486, 0.0131764780764522, 0.012991084849459, 0.0128042786430334, 0.0126175611511937, 0.0124325649652552, 0.0122508597741167, 0.0120742153468194, 0.0119039994539025, 0.0117411050164238, 0.0115857388280936, 0.0114367956540312, 0.0111902514102148, 0.010957512443657, 0.0107403843580462, 0.0105410286310819, 0.0103580351122081, 0.0101944163506117, 0.0100479360291117, 0.00991665578966976, 0.00979884006553897, 0.00969284813748872, 0.00961586054900604, 0.00954999702001975, 0.00949631456443399, 0.00945588680787519, 0.00942984601081966, 0.00941880794981428, 0.00942197106519021, 0.00943842964298089, 0.00946652109208131, 0.00950801794388661, 0.00959028691867274, 0.00970472111446867, 0.00985994561438345, 0.010007237865078, 0.010095673894721, 0.0101969865056764, 0.0103269900875674, 0.0105727774603766, 0.0106228216946289, 0.0108314722740156, 0.0110944672732226, 0.0113827067105667, 0.0116966038156832, 0.0120365347870835, 0.0124027971611773, 0.0127970672383625, 0.0132206581810658, 0.013672795614131, 0.0141521320244945, 0.0146565717018627, 0.0150981158583497, 0.0155589109133942, 0.0160422691138797, 0.0165522291946428, 0.0170935399330301, 0.0176693429245928, 0.0182810116542401, 0.0189315510547356, 0.0196243921040054, 0.0203632656800175, 0.0212531181485582, 0.022205915508263, 0.0232259941374111, 0.0243179178112612, 0.0254861874431816, 0.0267369780387309, 0.0280764963412165, 0.0295089687407924, 0.0310380956113823, 0.0326664188885559, 0.0342388912682147, 0.0359043509857943, 0.0376722483104589, 0.0395523875768331, 0.0415571164766266, 0.0436966815925624, 0.045978811043122, 0.0484151262162318, 0.05101644087158, 0.0537950916761219, 0.0566444741564359, 0.0596852385271943, 0.0629273918843848, 0.0663781751113122, 0.070045328428895, 0.0739374856469891, 0.0780599941553207, 0.0824024046219843, 0.0869438079653019, 0.0916527022825667, 0.0970790698494153, 0.102668525226657, 0.108409035565478, 0.114290116116528, 0.120304790359664, 0.126415818527748, 0.132605855908561, 0.138916546412088, 0.14541092043208, 0.152178332501869, 0.159897899362419, 0.167961469010187, 0.176278668451992, 0.184731757880114, 0.193174452958538, 0.201510155386286, 0.209707347590309, 0.217701109985542, 0.225430916961672, 0.232842245548182, 0.238675929815071, 0.244205533649315, 0.249427047549536, 0.254340036744505, 0.258951908640727, 0.263255056411777, 0.267259374209266, 0.271002920324447, 0.274531877033225, 0.277896155895588, 0.281070147312457, 0.284114570844515, 0.287019360748303, 0.289773267902141, 0.29236728371705, 0.29480520126367, 0.297103822097491, 0.299271764720538, 0.301318359462685, 0.303253589514219, 0.305660584171387, 0.307896067128473, 0.309968936260337, 0.311889487922719, 0.313666775121424, 0.315310122284561, 0.316828456205311, 0.318229422373544, 0.319518894900879, 0.320703134048747, 0.321389377457503, 0.32203822615647, 0.322652470312647, 0.323235218564795, 0.323789840742239, 0.324318884425506, 0.324823017487946, 0.325303756916887, 0.325760884104457, 0.32619616718388, 0.326639870365573, 0.327060896132431, 0.327458872001012, 0.327834109972786, 0.3281876854582, 0.328518451726359, 0.328830320076042, 0.329122266932115, 0.32939595562848, 0.329652454283425, 0.329968022586857, 0.330257921564732, 0.330523213810193, 0.330765573789917, 0.330986632624209, 0.331188021201475, 0.331371445738171, 0.33153854837255, 0.331690895353195, 0.331830579496708, 0.331969579137801, 0.332096532003237, 0.332212058469451, 0.332317307731269, 0.332413355931759, 0.332501187904172, 0.332582079029133, 0.332654784499449, 0.332721612615368, 0.332783077268171, 0.332796655542938, 0.332811467020514, 0.332827334181398, 0.332842227728402, 0.332857875286017, 0.332873554845502, 0.332889202853786, 0.332904751978411, 0.332920802355066, 0.332935404960692, 0.332963495234914, 0.332990252140162, 0.333013810138165, 0.333036257002042, 0.333057718710992, 0.333076966128684, 0.333094783571114, 0.333110578294132, 0.333125813312047, 0.333139894396713, 0.333151751615673, 0.333162778432087, 0.333173708513599, 0.333182546383663, 0.33319139167732, 0.333200283685392, 0.333207241858642, 0.333214954663992, 0.333220794548952, 0.333227404426159, 0.333232889536215, 0.333238414713316, 0.333243993240457, 0.333248394933149, 0.333252282176758, 0.33325506389295, 0.333257991471052, 0.333260461429118, 0.33326310155466, 0.333264082408396, 0.333265928420451, 0.333266072824846, 0.33326700226216, 0.333266212401798, 0.333265585141617, 0.33326448455888, 0.333263555202044, 0.333260815458854, 0.333258215715398, 0.333255078109451, 0.333253204033868, 0.333250362785667, 0.333246539995783, 0.333243756408354, 0.333239966642891, 0.333235155773698, 0.333230657072885, 0.333226447362528, 0.333221169017637, 0.333215472607716, 0.333208198757388, 0.333201702350392, 0.333193985782339, 0.333185675829722, 0.333176090708005, 0.333166479260899, 0.333156796767115, 0.33314506370802, 0.333133176207062, 0.333120436224812
    }, "linear srgb b");
    defer linear_srgb_b_staging_buffer.destroy(vc);
    // TODO: this D65 is normalized to some arbitrary value, which is fine, as our XYZ -> sRGB conversion
    // is derived from this D65. but ideally the scale here would have some physical meaning so it made
    // sense outside of sRGB as well
    const d65_staging_buffer, const d65 = try createSpectrumImage(vc, vk_allocator, encoder, descriptor_set, 7, &[_]f32 {
        0.0341, 0.36014, 0.68618, 1.01222, 1.33826, 1.6643, 1.99034, 2.31638, 2.64242, 2.96846, 3.2945, 4.98865, 6.6828, 8.37695, 10.0711, 11.7652, 13.4594, 15.1535, 16.8477, 18.5418, 20.236, 21.9177, 23.5995, 25.2812, 26.963, 28.6447, 30.3265, 32.0082, 33.69, 35.3717, 37.0535, 37.343, 37.6326, 37.9221, 38.2116, 38.5011, 38.7907, 39.0802, 39.3697, 39.6593, 39.9488, 40.4451, 40.9414, 41.4377, 41.934, 42.4302, 42.9265, 43.4228, 43.9191, 44.4154, 44.9117, 45.0844, 45.257, 45.4297, 45.6023, 45.775, 45.9477, 46.1203, 46.293, 46.4656, 46.6383, 47.1834, 47.7285, 48.2735, 48.8186, 49.3637, 49.9088, 50.4539, 50.9989, 51.544, 52.0891, 51.8777, 51.6664, 51.455, 51.2437, 51.0323, 50.8209, 50.6096, 50.3982, 50.1869, 49.9755, 50.4428, 50.91, 51.3773, 51.8446, 52.3118, 52.7791, 53.2464, 53.7137, 54.1809, 54.6482, 57.4589, 60.2695, 63.0802, 65.8909, 68.7015, 71.5122, 74.3229, 77.1336, 79.9442, 82.7549, 83.628, 84.5011, 85.3742, 86.2473, 87.1204, 87.9936, 88.8667, 89.7398, 90.6129, 91.486, 91.6806, 91.8752, 92.0697, 92.2643, 92.4589, 92.6535, 92.8481, 93.0426, 93.2372, 93.4318, 92.7568, 92.0819, 91.4069, 90.732, 90.057, 89.3821, 88.7071, 88.0322, 87.3572, 86.6823, 88.5006, 90.3188, 92.1371, 93.9554, 95.7736, 97.5919, 99.4102, 101.228, 103.047, 104.865, 106.079, 107.294, 108.508, 109.722, 110.936, 112.151, 113.365, 114.579, 115.794, 117.008, 117.088, 117.169, 117.249, 117.33, 117.41, 117.49, 117.571, 117.651, 117.732, 117.812, 117.517, 117.222, 116.927, 116.632, 116.336, 116.041, 115.746, 115.451, 115.156, 114.861, 114.967, 115.073, 115.18, 115.286, 115.392, 115.498, 115.604, 115.711, 115.817, 115.923, 115.212, 114.501, 113.789, 113.078, 112.367, 111.656, 110.945, 110.233, 109.522, 108.811, 108.865, 108.92, 108.974, 109.028, 109.082, 109.137, 109.191, 109.245, 109.3, 109.354, 109.199, 109.044, 108.888, 108.733, 108.578, 108.423, 108.268, 108.112, 107.957, 107.802, 107.501, 107.2, 106.898, 106.597, 106.296, 105.995, 105.694, 105.392, 105.091, 104.79, 105.08, 105.37, 105.66, 105.95, 106.239, 106.529, 106.819, 107.109, 107.399, 107.689, 107.361, 107.032, 106.704, 106.375, 106.047, 105.719, 105.39, 105.062, 104.733, 104.405, 104.369, 104.333, 104.297, 104.261, 104.225, 104.19, 104.154, 104.118, 104.082, 104.046, 103.641, 103.237, 102.832, 102.428, 102.023, 101.618, 101.214, 100.809, 100.405, 100.561, 99.6334, 99.2668, 98.9003, 98.5337, 98.1671, 97.8005, 97.4339, 97.0674, 96.7008, 96.3342, 96.2796, 96.225, 96.1703, 96.1157, 96.0611, 96.0065, 95.9519, 95.8972, 95.8426, 95.788, 95.0778, 94.3675, 93.6573, 92.947, 92.2368, 91.5266, 90.8163, 90.1061, 89.3958, 88.6856, 88.8177, 88.9497, 89.0818, 89.2138, 89.3459, 89.478, 89.61, 89.7421, 89.8741, 90.0062, 89.9655, 89.9248, 89.8841, 89.8434, 89.8026, 89.7619, 89.7212, 89.6805, 89.6398, 89.5991, 89.4091, 89.219, 89.029, 88.8389, 88.6489, 88.4589, 88.2688, 88.0788, 87.8887, 87.6987, 87.2577, 86.8167, 86.3757, 85.9347, 85.4936, 85.0526, 84.6116, 84.1706, 83.7296, 83.2886, 83.3297, 83.3707, 83.4118, 83.4528, 83.4939, 83.535, 83.576, 83.6171, 83.6581, 83.6992, 83.332, 82.9647, 82.5975, 82.2302, 81.863, 81.4958, 81.1285, 80.7613, 80.394, 80.0268, 80.0456, 80.0644, 80.0831, 80.1019, 80.1207, 80.1395, 80.1583, 80.177, 80.1958, 80.2146, 80.4209, 80.6272, 80.8336, 81.0399, 81.2462, 81.4525, 81.6588, 81.8652, 82.0715, 82.2778, 81.8784, 81.4791, 81.0797, 80.6804, 80.281, 79.8816, 79.4823, 79.0829, 78.6836, 78.2842, 77.4279, 76.5716, 75.7153, 74.859, 74.0027, 73.1465, 72.2902, 71.4339, 70.5776, 69.7213, 69.9101, 70.0989, 70.2876, 70.4764, 70.6652, 70.854, 71.0428, 71.2315, 71.4203, 71.6091, 71.8831, 72.1571, 72.4311, 72.7051, 72.979, 73.253, 73.527, 73.801, 74.075, 74.349, 73.0745, 71.8, 70.5255, 69.251, 67.9765, 66.702, 65.4275, 64.153, 62.8785, 61.604, 62.4322, 63.2603, 64.0885, 64.9166, 65.7448, 66.573, 67.4011, 68.2293, 69.0574, 69.8856, 70.4057, 70.9259, 71.446, 71.9662, 72.4863, 73.0064, 73.5266, 74.0467, 74.5669, 75.087, 73.9376, 72.7881, 71.6387, 70.4893, 69.3398, 68.1904, 67.041, 65.8916, 64.7421, 63.5927, 61.8752, 60.1578, 58.4403, 56.7229, 55.0054, 53.288, 51.5705, 49.8531, 48.1356, 46.4182, 48.4569, 50.4956, 52.5344, 54.5731, 56.6118, 58.6505, 60.6892, 62.728, 64.7667, 66.8054, 66.4631, 66.1209, 65.7786, 65.4364, 65.0941, 64.7518, 64.4096, 64.0673, 63.7251, 63.3828, 63.4749, 63.567, 63.6592, 63.7513, 63.8434, 63.9355, 64.0276, 64.1198, 64.2119, 64.304, 63.8188, 63.3336, 62.8484, 62.3632, 61.8779, 61.3927, 60.9075, 60.4223, 59.9371, 59.4519, 58.7026, 57.9533, 57.204, 56.4547, 55.7054, 54.9562, 54.2069, 53.4576, 52.7083, 51.959, 52.5072, 53.0553, 53.6035, 54.1516, 54.6998, 55.248, 55.7961, 56.3443, 56.8924, 57.4406, 57.7278, 58.015, 58.3022, 58.5894, 58.8765, 59.1637, 59.4509, 59.7381, 60.0253, 60.3125
    }, "d65");
    defer d65_staging_buffer.destroy(vc);
    try encoder.submitAndIdleUntilDone(vc);

    return Self {
        .descriptor_layout = descriptor_layout,
        .descriptor_set = descriptor_set,
        .sampler = sampler,
        .cie_x = cie_x,
        .cie_y = cie_y,
        .cie_z = cie_z,
        .linear_srgb_r = linear_srgb_r,
        .linear_srgb_g = linear_srgb_g,
        .linear_srgb_b = linear_srgb_b,
        .d65 = d65,
    };
}

pub fn destroy(self: *Self, vc: *const VulkanContext) void {
    self.descriptor_layout.destroy(vc);
    vc.device.destroySampler(self.sampler, null);
    self.cie_x.destroy(vc);
    self.cie_y.destroy(vc);
    self.cie_z.destroy(vc);
    self.linear_srgb_r.destroy(vc);
    self.linear_srgb_g.destroy(vc);
    self.linear_srgb_b.destroy(vc);
    self.d65.destroy(vc);
}